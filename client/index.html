<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>接口列表 - SNAKE-API</title>
  <link href="./lib/bootstrap.min.css" rel="stylesheet">
  <style>
    #interface-data {
      position: relative;
      width: 100%;
      height: 300px;
    }

    #preview {
      height: 300px;
    }

    /* 去掉json编辑器的错误图标 */
    .ace_gutter-cell.ace_error {
      background-image: none !important;
    }
  </style>
</head>

<body>
  <!-- nav -->
  <div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="/mock">SNAKE-API <small>Mini</small></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-item nav-link active" href="/mock">接口列表 <span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link" href="/mock/base-data.html">基础数据维护</a>
          <a class="nav-item nav-link" href="/mock/prefix.html">接口前缀维护</a>
        </div>
      </div>
    </nav>
  </div>

  <div class="p-3">
    <!-- 筛选 -->
    <div>
      <form>
        <div class="form-row align-items-center">
          <div class="col-auto">
            <label class="sr-only" for="search-name">接口名称</label>
            <input type="text" class="form-control mb-2" id="search-name" placeholder="接口名称">
          </div>
          <div class="col-auto">
            <label class="sr-only" for="search-url">接口地址</label>
            <input type="text" class="form-control mb-2" id="search-url" placeholder="接口地址">
          </div>

          <div class="col-auto">
            <button type="button" class="btn btn-primary mb-2" onclick="searchlist(1)">查询</button>
          </div>
        </div>
      </form>
    </div>
    <!-- add -->
    <div class="pt-3 pb-3">
      <button type="button" class="btn btn-primary mr-2" data-toggle="modal" data-target="#exampleModal"
        onclick="openAddModal()">
        新增接口
      </button>
      <button type="button" class="btn btn-dark" onclick="openImportSwaggerInterfaceModal()">
        导入swagger接口
      </button>
      <button type="button" class="btn btn-outline-danger float-right" onclick="removeInterface()">
        清空当前所有接口
      </button>
    </div>
    <!-- table -->
    <div>
      <table class="table">
        <thead>
          <tr>
            <th scope="col" width="5%" class="text-center">序号</th>
            <th scope="col" width="10">接口名称</th>
            <th scope="col" width="8%" class="text-center">接口类型</th>
            <th scope="col" width="20%">接口前缀</th>
            <th scope="col" width="30%">接口地址</th>
            <th scope="col" width="12%" class="text-center">Mock启用状态</th>
            <th scope="col" width="15%" class="text-center">操作</th>
          </tr>
        </thead>
        <tbody id="table-tbody"></tbody>
      </table>
      <div id="page"></div>
    </div>
  </div>
  <script id="list-template" type="text/x-handlebars-template">
  {{#each this}}
  <tr>
    <th scope="row" class="text-center">{{addOne @index}}</th>
    <td>{{name}}</td>
    <td class="text-center">
      <button type="button" class="btn {{formatMethod method}} btn-sm" style="width:56px;">{{method}}</button>
    </td>
    <td>{{noValue prefix}}</td>
    <td>{{path}}</td>
    <td class="text-center">
      <div class="dropdown">
        <button class="btn {{#if isOpen}}btn-outline-success{{else}}btn-outline-danger{{/if}} dropdown-toggle btn-sm"
                type="button" id="dropdownMenuButton-{{@index}}" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
          {{#if isOpen}}启用中{{else}}停用中{{/if}}
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-{{@index}}">
          <a class="dropdown-item {{#if isOpen}}disabled{{/if}}" href="javascript:;"
             onclick="changeStatus(this,'{{_id}}',true)">启用</a>
          <a class="dropdown-item {{#if isOpen}}{{else}}disabled{{/if}}" href="javascript:;"
             onclick="changeStatus(this,'{{_id}}',false)">停用</a>
        </div>
      </div>
    </td>
    <td class="text-center">
      <button type="button" class="btn btn-primary btn-sm" onclick="getInterface('{{_id}}')">查看</button>
      <button type="button" class="btn btn-info btn-sm" onclick="editInterface('{{_id}}')">编辑</button>
      <button type="button" class="btn btn-warning btn-sm" onclick="deleteInterface('{{_id}}')">删除</button>
    </td>
  </tr>
  {{/each}}
  </script>
  <!-- page -->
  <script id="page-template" type="text/x-handlebars-template">
  <nav aria-label="Page navigation example">
    <ul class="pagination">
      <li class="page-item">
        <span class="page-link">共{{pages}}页/{{total}}条</span>
      </li>
      <li class="page-item">
        <a id="btnGroupDrop1" class="page-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" href="javascript:;">
          每页<span id="rows">{{rows}}</span>条
        </a>
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','5')">5条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','10')">10条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','20')">20条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','50')">50条</a>
        </div>
      </li>
      <li class="page-item {{#compare page '==' 1}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('1')" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous First</span>
        </a>
      </li>
      <li class="page-item {{#compare page '==' 1}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{prevPage}}')" aria-label="Previous">
          <span aria-hidden="true">&lsaquo;</span>
          <span class="sr-only">Previous</span>
        </a>
      </li>
      {{#each this.pageList}}
      <li class="page-item {{#compare this '==' ../page}}active{{/compare}}"><a class="page-link" href="javascript:;" onclick="searchlist('{{this}}')">{{this}}</a></li>
      {{/each}}
      <li class="page-item {{#compare page '==' pages}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{nextPage}}')" aria-label="Next">
          <span aria-hidden="true">&rsaquo;</span>
          <span class="sr-only">Next</span>
        </a>
      </li>
      <li class="page-item {{#compare page '==' pages}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{pages}}')" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next Last</span>
        </a>
      </li>
    </ul>
  </nav>
  </script>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">新增接口</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="interface-name">接口名称</label>
              <input type="email" class="form-control" id="interface-name" placeholder="请输入接口名称">
            </div>
            <div class="form-group">
              <label for="interface-path">接口地址</label>
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false" style="width:84px;" data-value="GET"
                    id="interface-method">GET</button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="#" data-value="GET" onclick="selectedDropdown(this)">GET</a>
                    <a class="dropdown-item" href="#" data-value="POST" onclick="selectedDropdown(this,)">POST</a>
                  </div>
                </div>
                <div class="input-group-prepend">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false" style="width:254px;" data-value=""
                    id="interface-prefix">无接口前缀</button>
                  <div class="dropdown-menu" id="interface-prefix-list">
                    <a class="dropdown-item" href="#" data-value="" onclick="selectedDropdown(this)">无接口前缀</a>
                  </div>
                </div>
                <input type="text" class="form-control" id="interface-path" placeholder="请输入接口地址 例如:/api/xxx"
                  aria-label="Text input with dropdown button">
              </div>
            </div>
            <div class="form-group">
              <label for="interface-data">模拟数据</label>
              <br>
              <div class="clearfix mb-2">
                <div class="btn-group btn-group-sm float-left" role="group" aria-label="Basic example">
                  <button type="button" class="btn btn-primary" onclick="changePreview(this,false)">编辑</button>
                  <button type="button" class="btn btn-outline-primary" onclick="changePreview(this,true)">预览</button>
                </div>

                <div class="float-right" id="init-data-btn">
                  <button type="button" class="btn btn-link btn-sm" onclick="initBaseData('base-data')">初始基础数据</button>
                  <button type="button" class="btn btn-link btn-sm"
                    onclick="initBaseData('base-data-page')">初始基础分页数据</button>
                </div>
                <!-- 交互逻辑问题,待保留 -->
                <!-- <div class="float-right" id="init-mock-btn">
                  <button type="button" class="btn btn-link btn-sm" onclick="initMock()">生成Mock数据</button>
                </div> -->
              </div>
              <div class="form-control" id="interface-data"></div>
              <textarea class="form-control" aria-label="With textarea" id="preview" disabled
                style="display:none;"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary" onclick="saveInterface()" id="save-btn">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 导入swagger接口弹出框 -->
  <div class="modal fade" id="importSwaggerInterfaceModal" tabindex="-1" role="dialog"
    aria-labelledby="importSwaggerInterfaceModal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">导入Swagger接口</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-3 text-right" style="line-height: 38px;">Swagger 数据地址：</div>
            <div class="col-sm-6">
              <input type="text" class="form-control" id="swagger-json-address" placeholder="http://">
            </div>
            <div class="col-sm-3">
              <button type="button" class="btn btn-primary" onclick="getSwaggerJsonData(this)">获取</button>
              <button class="btn btn-primary" type="button" disabled style="display: none;">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                获取中...
              </button>
            </div>
          </div>
          <div class="mt-3" style="height: 1px;background-color: #dee2e6;"></div>
          <div id="swagger-path-warp"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" onclick="confirmImport()" id="save-btn">确认导入</button>
        </div>
      </div>
    </div>
  </div>

  <script id="swagger-path-template" type="text/x-handlebars-template">
    <button type="button" class="btn btn-link" data-toggle="collapse" data-target=".tagName-collapse" aria-expanded="false">一键展开收起</button>
    {{#each this}}
    <div class="card">
      <!-- tag -->
      <div class="card-header" data-toggle="collapse" href="#tagName-{{@index}}" aria-expanded="false" aria-controls="tagName-{{@index}}">
        <input name="swagger-tag" type="checkbox" onclick="changeTagPaths(this)">
        {{name}}
      </div>
      <ul class="collapse tagName-collapse p-0" id="tagName-{{@index}}" style="list-style: none;">
        {{#each this.paths}}
        <!-- path -->
        <li class="border-bottom pt-2 pb-2 pl-4 pr-4">
          <input name="swagger-tag-path" type="checkbox" value="{{path}}">
          {{path}} {{name}}
        </li>
        {{/each}}
      </ul>
    </div>
    {{/each}}
  </script>

  <!-- alert info -->
  <div id="alert" class="alert alert-success position-fixed w-50" role="alert"
    style="display: none;top:40px;left:50%;margin-left:-25%;z-index:9999999999"></div>

  <script src="./lib/jquery.min.js"></script>
  <script src="./lib/popper.min.js"></script>
  <script src="./lib/handlebars.min.js"></script>
  <script src="./lib/bootstrap.min.js"></script>
  <script src="./lib/json5.min.js"></script>
  <script src="./lib/ace-1.4.4/src/ace.js"></script>
  <script src="./lib/ace-1.4.4/src/theme-chrome.js"></script>
  <script src="./lib/ace-1.4.4/src/mode-json.js"></script>
  <script src="./lib/ace-1.4.4/src/snippets/json.js"></script>
  <script src="./lib/ace-1.4.4/src/ext-language_tools.js"></script>

  <script src="./lib/mock/mock-min.js"></script>
  <script src="./index.js"></script>
</body>

</html>
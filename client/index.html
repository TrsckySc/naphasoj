<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Cache" content="no-cache">
  <title>接口列表 - SNAKE-API</title>
  <link href="./lib/bootstrap.min.css" rel="stylesheet">
  <style>
    #interface-data {
      position: relative;
      width: 100%;
      min-height: 140px;
    }

    #preview {
      height: 300px;
    }

    /* 去掉json编辑器的错误图标 */
    .ace_gutter-cell.ace_error {
      background-image: none !important;
    }
  </style>
</head>

<body>
  <!-- nav -->
  <div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="/mock">SNAKE-API <small>Mini</small></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-between" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-item nav-link active" href="/mock">接口列表 <span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link" href="/mock/base-data.html">响应数据维护</a>
          <a class="nav-item nav-link" href="/mock/prefix.html">接口前缀维护</a>
        </div>
        <div>
          <a class="btn-link text-secondary" href="https://www.snake-api.com" target="_blank">SNAKE-API 官网</a>
        </div>
      </div>
    </nav>
  </div>

  <div class="p-3">
    <!-- 筛选 -->
    <div>
      <form onsubmit="searchlist(1);return false;">
        <div class="form-row align-items-center">
          <div class="col-auto">
            <label class="sr-only" for="search-name">接口名称</label>
            <input type="text" class="form-control mb-2" id="search-name" placeholder="接口名称">
          </div>
          <div class="col-auto">
            <label class="sr-only" for="search-url">接口地址</label>
            <input type="text" class="form-control mb-2" id="search-url" placeholder="接口地址">
          </div>

          <div class="col-auto">
            <button type="submit" class="btn btn-primary mb-2">查询</button>
          </div>
        </div>
      </form>
    </div>
    <!-- add -->
    <div class="pt-3 pb-3">
      <button type="button" class="btn btn-primary mr-2" data-toggle="modal" data-target="#exampleModal"
        onclick="openAddModal()">
        新增接口
      </button>
      <button type="button" class="btn btn-dark" onclick="openImportSwaggerInterfaceModal()">
        导入swagger接口
      </button>
      <button type="button" class="btn btn-outline-danger float-right" onclick="removeInterface()">
        清空当前所有接口
      </button>
    </div>
    <!-- table -->
    <div>
      <table class="table">
        <thead>
          <tr>
            <th scope="col" width="5%" class="text-center">序号</th>
            <th scope="col" width="10">接口名称</th>
            <th scope="col" width="8%" class="text-center">接口类型</th>
            <th scope="col" width="20%">接口前缀</th>
            <th scope="col" width="25%">接口地址</th>
            <th scope="col" width="12%" class="text-center">Mock启用状态</th>
            <th scope="col" width="20%" class="text-center">操作</th>
          </tr>
        </thead>
        <tbody id="table-tbody"></tbody>
      </table>
      <div id="page"></div>
    </div>
  </div>
  <script id="list-template" type="text/x-handlebars-template">
  {{#each this}}
  <tr>
    <th scope="row" class="text-center">{{addOne @index}}</th>
    <td>{{name}}</td>
    <td class="text-center">
      <button type="button" class="btn {{formatMethod method}} btn-sm" style="width:56px;">{{method}}</button>
    </td>
    <td>{{noValue prefix}}</td>
    <td>
      <span style="cursor: pointer;" onclick="copyPath('{{path}}')">
        <svg class="bi bi-documents" width="1.2em" height="1.2em" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" d="M5 4h8a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2zm0 1a1 1 0 00-1 1v10a1 1 0 001 1h8a1 1 0 001-1V6a1 1 0 00-1-1H5z" clip-rule="evenodd"></path>
          <path d="M7 2h8a2 2 0 012 2v10a2 2 0 01-2 2v-1a1 1 0 001-1V4a1 1 0 00-1-1H7a1 1 0 00-1 1H5a2 2 0 012-2z"></path>
        </svg>
      </span>
      {{path}}
    </td>
    <td class="text-center">
      <div class="dropdown">
        <button class="btn {{#if isOpen}}btn-outline-success{{else}}btn-outline-danger{{/if}} dropdown-toggle btn-sm"
                type="button" id="dropdownMenuButton-{{@index}}" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
          {{#if isOpen}}启用中{{else}}停用中{{/if}}
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-{{@index}}">
          <a class="dropdown-item {{#if isOpen}}disabled{{/if}}" href="javascript:;"
             onclick="changeStatus(this,'{{_id}}',true)">启用</a>
          <a class="dropdown-item {{#if isOpen}}{{else}}disabled{{/if}}" href="javascript:;"
             onclick="changeStatus(this,'{{_id}}',false)">停用</a>
        </div>
      </div>
    </td>
    <td class="text-center">
      <button
        type="button"
        class="btn btn-light btn-sm {{#if isLock}}{{else}}d-none{{/if}}"
        onclick="changeLockStatus(this, '{{_id}}', false)"
      >
      <svg class="bi bi-lock" width="1.5em" height="1.5em" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M13.655 9H6.333c-.264 0-.398.068-.471.121a.73.73 0 00-.224.296 1.626 1.626 0 00-.138.59V15c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 00.436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 00.224-.296 1.627 1.627 0 00.138-.59V10c0-.342-.076-.531-.14-.635a.658.658 0 00-.255-.237 1.123 1.123 0 00-.45-.128zm.012-1H6.333C4.5 8 4.5 10 4.5 10v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2v-5c0-2-1.833-2-1.833-2zM6.5 5a3.5 3.5 0 117 0v3h-1V5a2.5 2.5 0 00-5 0v3h-1V5z" clip-rule="evenodd"></path>
      </svg>
      </button>
      <button 
        type="button" 
        class="btn btn-light btn-sm {{#if isLock}}d-none{{/if}}" 
        onclick="changeLockStatus(this, '{{_id}}', true)"
      >
      <svg class="bi bi-unlock" width="1.5em" height="1.5em" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M11.655 9H4.333c-.264 0-.398.068-.471.121a.73.73 0 00-.224.296 1.626 1.626 0 00-.138.59V15c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 00.436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 00.224-.296 1.627 1.627 0 00.138-.59V10c0-.342-.076-.531-.14-.635a.658.658 0 00-.255-.237 1.123 1.123 0 00-.45-.128zm.012-1H4.333C2.5 8 2.5 10 2.5 10v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2v-5c0-2-1.833-2-1.833-2zM10.5 5a3.5 3.5 0 117 0v3h-1V5a2.5 2.5 0 00-5 0v3h-1V5z" clip-rule="evenodd"></path>
      </svg>
      </button>
      <button 
        type="button"
        class="btn btn-primary btn-sm"
        onclick="getInterface('{{_id}}')"
      >查看</button>
      <button 
        type="button" 
        class="btn btn-info btn-sm {{#if isLock}}d-none{{/if}}" 
        onclick="editInterface('{{_id}}')"
      >编辑</button>
      <button
        type="button" 
        class="btn btn-warning btn-sm {{#if isLock}}d-none{{/if}}" 
        onclick="deleteInterface('{{_id}}')"
      >删除</button>
    </td>
  </tr>
  {{/each}}
  </script>
  <!-- page -->
  <script id="page-template" type="text/x-handlebars-template">
  <nav aria-label="Page navigation example">
    <ul class="pagination">
      <li class="page-item">
        <span class="page-link">共{{pages}}页/{{total}}条</span>
      </li>
      <li class="page-item">
        <a id="btnGroupDrop1" class="page-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" href="javascript:;">
          每页<span id="rows">{{rows}}</span>条
        </a>
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','5')">5条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','10')">10条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','20')">20条</a>
          <a class="dropdown-item" href="javascript:;" onclick="searchlist('1','50')">50条</a>
        </div>
      </li>
      <li class="page-item {{#compare page '==' 1}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('1')" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous First</span>
        </a>
      </li>
      <li class="page-item {{#compare page '==' 1}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{prevPage}}')" aria-label="Previous">
          <span aria-hidden="true">&lsaquo;</span>
          <span class="sr-only">Previous</span>
        </a>
      </li>
      {{#each this.pageList}}
      <li class="page-item {{#compare this '==' ../page}}active{{/compare}}"><a class="page-link" href="javascript:;" onclick="searchlist('{{this}}')">{{this}}</a></li>
      {{/each}}
      <li class="page-item {{#compare page '==' pages}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{nextPage}}')" aria-label="Next">
          <span aria-hidden="true">&rsaquo;</span>
          <span class="sr-only">Next</span>
        </a>
      </li>
      <li class="page-item {{#compare page '==' pages}}disabled{{/compare}}">
        <a class="page-link" href="javascript:;" onclick="searchlist('{{pages}}')" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next Last</span>
        </a>
      </li>
    </ul>
  </nav>
  </script>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">新增接口</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="interface-name">接口名称</label>
              <input type="email" class="form-control" id="interface-name" placeholder="请输入接口名称">
            </div>
            <div class="form-group">
              <label for="interface-path">接口地址</label>
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false" style="width:84px;" data-value="GET"
                    id="interface-method">GET</button>
                  <div class="dropdown-menu">
                    <a class="dropdown-item" href="#" data-value="GET" onclick="selectedDropdown(this)">GET</a>
                    <a class="dropdown-item" href="#" data-value="POST" onclick="selectedDropdown(this,)">POST</a>
                  </div>
                </div>
                <div class="input-group-prepend">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false" style="width:254px;" data-value=""
                    id="interface-prefix">无接口前缀</button>
                  <div class="dropdown-menu" id="interface-prefix-list">
                    <a class="dropdown-item" href="#" data-value="" onclick="selectedDropdown(this)">无接口前缀</a>
                  </div>
                </div>
                <input type="text" class="form-control" id="interface-path" placeholder="请输入接口地址 例如:/api/xxx"
                  aria-label="Text input with dropdown button">
              </div>
            </div>
            <div class="form-group">
              <label for="interface-data">模拟数据</label>
              <br>
              <div class="clearfix mb-2">
                <div class="btn-group btn-group-sm float-left" role="group" aria-label="Basic example">
                  <button type="button" class="btn btn-primary" onclick="changePreview(this,false)">编辑</button>
                  <button type="button" class="btn btn-outline-primary" onclick="changePreview(this,true)">预览</button>
                </div>

                <div class="float-right" id="init-data-btn">
                  <button type="button" class="btn btn-link btn-sm" onclick="initBaseData('base-data')">初始基础数据</button>
                  <button type="button" class="btn btn-link btn-sm"
                    onclick="initBaseData('base-data-page')">初始基础分页数据</button>
                </div>
                <!-- 交互逻辑问题,待保留 -->
                <!-- <div class="float-right" id="init-mock-btn">
                  <button type="button" class="btn btn-link btn-sm" onclick="initMock()">生成Mock数据</button>
                </div> -->
              </div>
              <div class="form-control" id="interface-data"></div>
              <textarea class="form-control" aria-label="With textarea" id="preview" disabled
                style="display:none;"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <span class="text-secondary flex-grow-1" style="font-size: 14px;">提示:编辑器内使用快捷键 <kbd>Ctrl+Enter</kbd>或<kbd>Command+Enter</kbd> 可切换全屏状态</span>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary" onclick="saveInterface()" id="save-btn">保存</button>
          <button type="button" class="btn btn-primary" onclick="updateInterface()" id="update-btn">更新
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 导入swagger接口弹出框 -->
  <div class="modal fade" id="importSwaggerInterfaceModal" tabindex="-1" role="dialog"
    aria-labelledby="importSwaggerInterfaceModal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">导入Swagger接口</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-sm-4 text-right" style="line-height: 38px;">Swagger JSON 数据地址：</div>
            <div class="col-sm-6">
              <input type="text" class="form-control" id="swagger-json-address" placeholder="http://">
            </div>
            <div class="col-sm-2">
              <button type="button" class="btn btn-primary" onclick="getSwaggerJsonData(this)">获取</button>
              <button class="btn btn-primary" type="button" disabled style="display: none;">
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                获取中...
              </button>
            </div>
          </div>
          <div class="mt-3" style="height: 1px;background-color: #dee2e6;"></div>
          <div id="swagger-path-warp"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" onclick="confirmImport()" id="save-btn">确认导入</button>
        </div>
      </div>
    </div>
  </div>

  <script id="swagger-path-template" type="text/x-handlebars-template">
    <div>
      <button type="button" class="btn btn-link" data-toggle="collapse" data-target=".tagName-collapse" aria-expanded="false">一键展开收起</button>
      <span class="float-right text-secondary" style="line-height: 38px;">注：现有接口不会被覆盖导入</span>
    </div>
    {{#each this}}
    <div class="card">
      <!-- tag -->
      <div class="card-header" data-toggle="collapse" href="#tagName-{{@index}}" aria-expanded="false" aria-controls="tagName-{{@index}}">
        <input name="swagger-tag" type="checkbox" onclick="changeTagPaths(this)">
        {{name}}
      </div>
      <ul class="collapse tagName-collapse p-0" id="tagName-{{@index}}" style="list-style: none;">
        {{#each this.paths}}
        <!-- path -->
        <li class="border-bottom pt-2 pb-2 pl-4 pr-4">
          <input name="swagger-tag-path" type="checkbox" value="{{path}}">
          {{path}} {{name}}
        </li>
        {{/each}}
      </ul>
    </div>
    {{/each}}
  </script>

  <!-- alert info -->
  <div id="alert" class="alert alert-success position-fixed w-50" role="alert"
    style="display: none;top:40px;left:50%;margin-left:-25%;z-index:9999999999"></div>

  <script src="./lib/jquery.min.js"></script>
  <script src="./lib/popper.min.js"></script>
  <script src="./lib/handlebars.min.js"></script>
  <script src="./lib/bootstrap.min.js"></script>
  <script src="./lib/json5.min.js"></script>
  <script src="./lib/ace-1.4.4/src/ace.js"></script>
  <script src="./lib/ace-1.4.4/src/theme-chrome.js"></script>
  <script src="./lib/ace-1.4.4/src/mode-json.js"></script>
  <script src="./lib/ace-1.4.4/src/snippets/json.js"></script>
  <script src="./lib/ace-1.4.4/src/ext-language_tools.js"></script>

  <script src="./lib/mock/mock-min.js"></script>
  <script src="./index.js"></script>
</body>

</html>
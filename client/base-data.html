<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>基础数据维护 - YSHA</title>
  <link href="./lib/bootstrap.min.css" rel="stylesheet">
  <style>
    #base-data,
    #base-page-data {
      position: relative;
      width: 100%;
      height: 300px;
    }

    #preview {
      height: 300px;
    }
  </style>
</head>

<body>
  <!-- nav -->
  <div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="/">YSHA</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-item nav-link" href="/">接口列表 <span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link active" href="/base-data">基础数据维护</a>
          <a class="nav-item nav-link" href="#">接口前缀维护</a>
          <a class="nav-item nav-link" href="#">需求模块维护</a>
          <a class="nav-item nav-link" href="#">数据扩展维护</a>
        </div>
      </div>
    </nav>
  </div>
  <div class="p-3 row">
    <h4 class="col-2">基础目标地址：</h4>
    <input type="text" class="form-control col-4" placeholder="例如：12.168.23.15:80">
  </div>
  <hr>
  <div class="p-3 row">
    <div class="col">
      <h4>响应体基础数据</h4>
      <div id="base-data"></div>
    </div>
    <div class="col">
      <h4>响应体基础分页数据</h4>
      <div id="base-page-data"></div>
    </div>
  </div>

  <!-- alert info -->
  <div id="alert" class="alert alert-success position-fixed w-50" role="alert"
    style="display: none;top:40px;left:50%;margin-left:-25%;z-index:9999999999"></div>

  <script src="./lib/jquery.min.js"></script>
  <script src="./lib/popper.min.js"></script>
  <script src="./lib/handlebars.min.js"></script>
  <script src="./lib/bootstrap.min.js"></script>
  <script src="./lib/json5.min.js"></script>
  <script src="./lib/ace-1.4.4/src/ace.js"></script>
  <script src="./lib/ace-1.4.4/src/theme-chrome.js"></script>
  <script src="./lib/ace-1.4.4/src/mode-json.js"></script>
  <script src="./lib/ace-1.4.4/src/snippets/json.js"></script>
  <script src="./lib/ace-1.4.4/src/ext-language_tools.js"></script>

  <script src="./lib/mock/mock-min.js"></script>
  <script>
    // 初始化编辑器
    function initAce(elementId) {
      var editor = ace.edit(elementId);
      editor.setTheme("ace/theme/chrome");//设置主题
      var JavaScriptMode = ace.require("ace/mode/json").Mode;
      editor.session.setMode(new JavaScriptMode());//设置程序语言模式

      // 设置自动补全
      var tangideCompleter = {
        getCompletions: function (editor, session, pos, prefix, callback) {
          if (prefix.length === 0) {
            return callback(null, []);
          } else {
            return callback(null, autoCompleteData);
          }
        }
      };
      editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
      });
      var langTools = ace.require("ace/ext/language_tools");
      langTools.addCompleter(tangideCompleter);

      // editor.getSession().setUseWrapMode(true);//设置折叠 默认折叠的
      editor.getSession().setTabSize(2);// 设置制表符大小
    }

    initAce('base-data');
    initAce('base-page-data');

    // 封装alert
    function alertInfo(content, type) {
      $('#alert').text(content);
      var alertEle = document.getElementById('alert');
      alertEle.className = 'alert position-fixed w-50' + ' alert-' + (type || 'success');
      $('#alert').fadeIn('fast');

      setTimeout(() => {
        $('#alert').fadeOut(2500);
      }, 2500);
    }

    // 切换预览与编辑
    function changePreview(owner, isPreview) {
      if (isPreview) {
        $('#interface-data').hide();
        $('#preview').show();
        $(owner).removeClass('btn-outline-primary').addClass('btn-primary');
        $(owner).prev().removeClass('btn-primary').addClass('btn-outline-primary');

        //mock
        try {
          var mock = JSON5.parse(editor.getValue());
          $('#preview').val(JSON.stringify(Mock.mock(mock), null, 4));
        } catch (reason) {
          $('#preview').val('格式错误:' + reason);
        }
      } else {
        $('#interface-data').show();
        $('#preview').hide();
        $(owner).removeClass('btn-outline-primary').addClass('btn-primary');
        $(owner).next().removeClass('btn-primary').addClass('btn-outline-primary');
      }
    }

  </script>
</body>

</html>